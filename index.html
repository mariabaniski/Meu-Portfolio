<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="theme-color" content="#000000"> <!-- barra superior preta -->
  <title>Gato Premiado üê±‚ú®</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: linear-gradient(-45deg, #000, #111, #222, #000);
      background-size: 400% 400%;
      animation: gradient 10s ease infinite;
      font-family: 'Poppins', sans-serif;
      color: white;
      text-align: center;
      touch-action: manipulation; /* melhora clique no celular */
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 {
      margin: 5px 0;
      font-size: clamp(1.8em, 6vw, 2.5em);
      color: gold;
      text-shadow: 0 0 15px rgba(255,215,0,0.8);
    }
    #timer {
      font-size: clamp(1.2em, 5vw, 2em);
      color: gold;
      text-shadow: 0 0 10px black;
    }
    canvas {
      display: block;
      margin: 0;
      background: transparent;
      width: 100vw;
      height: 100vh;
    }
    #prizeBox {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(17,17,17,0.95);
      border: 3px solid gold;
      border-radius: 20px;
      padding: 25px 40px;
      font-size: clamp(1.3em, 5vw, 2em);
      color: gold;
      text-shadow: 0 0 10px black;
      animation: none;
      z-index: 10;
    }
    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    /* Gatinho */
    #cat {
      position: absolute;
      bottom: 70px;
      left: 20px;
      font-size: clamp(50px, 12vw, 90px);
      animation: wiggle 2s infinite alternate;
    }
    @keyframes wiggle {
      from { transform: rotate(-5deg); }
      to { transform: rotate(5deg); }
    }
    #speech {
      position: absolute;
      bottom: 150px;
      left: 90px;
      background: #fff;
      color: #000;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: clamp(14px, 4vw, 20px);
      display: none;
      max-width: 70%;
    }
    /* Cr√©ditos */
    #credits-left, #credits-right {
      position: fixed;
      bottom: 5px;
      font-size: clamp(10px, 3.5vw, 14px);
      color: #aaa;
    }
    #credits-left { left: 10px; }
    #credits-right { right: 10px; }
    /* Efeito clique */
    .clickEffect {
      position: absolute;
      font-size: clamp(22px, 6vw, 32px);
      color: gold;
      pointer-events: none;
      animation: popFade 0.8s ease-out forwards;
    }
    @keyframes popFade {
      0% { transform: scale(0.5); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.9; }
      100% { transform: scale(1); opacity: 0; top: -20px; }
    }
  </style>
</head>
<body>
  <h1>üê± Gato Premiado üêü</h1>
  <div id="timer">Tempo: 60s</div>
  <canvas id="gameCanvas"></canvas>
  <div id="prizeBox"></div>
  <div id="cat">üê±</div>
  <div id="speech">Vai nessa, voc√™ consegue!</div>

  <div id="credits-left">Apetit Gat√¥ Sushi</div>
  <div id="credits-right">By Maria Baniski</div>
  
  <!-- Sons: preload + crossorigin + playsinline para melhor compatibilidade -->
  <audio id="catchSound" preload="auto" crossorigin="anonymous" playsinline src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b8f0ec6da.mp3"></audio>
  <audio id="failSound"  preload="auto" crossorigin="anonymous" playsinline src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_77dbb07a72.mp3"></audio>
  <audio id="winSound"   preload="auto" crossorigin="anonymous" playsinline src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f6d7bbf39a.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const prizeBox = document.getElementById("prizeBox");
    const timerEl = document.getElementById("timer");
    const speech = document.getElementById("speech");

    // audios (refer√™ncias JS)
    const catchSound = document.getElementById("catchSound");
    const failSound  = document.getElementById("failSound");
    const winSound   = document.getElementById("winSound");

    // resize canvas responsivo
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    let attempts = true;
    let gameOver = false;
    let timeLeft = 60;
    let startTime = Date.now();
    const minWinTime = 10000; // 10 segundos

    // ==== RESET AUTOM√ÅTICO DE DIA ====
    // chave com YYYY-MM-DD
    const today = new Date().toISOString().split("T")[0];
    // ler data salva (se houver)
    let lastWin = localStorage.getItem("lastWinDate");

    // se existe e for diferente de hoje => limpamos (virou o dia)
    if (lastWin && lastWin !== today) {
      localStorage.removeItem("lastWinDate");
      lastWin = null;
    }

    // se j√° tem vit√≥ria hoje, bloqueia imediatamente
    if (localStorage.getItem("lastWinDate") === today) {
      attempts = false;
      gameOver = true;
      speech.innerText = "Miauu! Voc√™ j√° ganhou hoje üêæ volte amanh√£!";
      speech.style.display = "block";
    }
    // ==== fim reset dia ====

    const prizes = [
      "Suco Kappo",
      "Coca Cola Caf√©",
      "Sobremesa",
      "Harumaki",
      "Por√ß√£o Surpresa",
      ...Array(15).fill("N√£o foi dessa vez")
    ];

    const emojis = ["üêü","üç£","üç§","üç•","üç°"];
    const fish = [];

    function createFish() {
      return {
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        speed: 3 + Math.random() * 3,
        size: 60 + Math.random() * 30, // maiores no celular
        emoji: emojis[Math.floor(Math.random() * emojis.length)],
        angle: 0
      };
    }

    function initFish() {
      fish.length = 0;
      for(let i=0;i<12;i++) fish.push(createFish()); // mais peixes
    }
    initFish();

    function drawFish(f) {
      ctx.save();
      ctx.translate(f.x, f.y);
      ctx.rotate(Math.sin(f.angle) * 0.3);
      ctx.font = f.size+"px Arial";
      ctx.fillText(f.emoji, 0, 0);
      ctx.restore();
    }

    function updateFish(f) {
      f.x += f.speed;
      f.angle += 0.1;
      if(f.x > canvas.width+50) {
        f.x = -50;
        f.y = Math.random() * canvas.height;
      }
    }

    function gameLoop() {
      if (gameOver) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      fish.forEach(f => {
        updateFish(f);
        drawFish(f);
      });
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // fun√ß√£o que tenta desbloquear √°udio no primeiro toque
    function tryUnlockAudio() {
      [catchSound, failSound, winSound].forEach(a => {
        if (!a) return;
        try {
          a.load();
          // tenta play/pause para "destravar" em mobile quando permitido
          a.play().then(() => {
            a.pause();
            a.currentTime = 0;
          }).catch(()=>{ /* ignore */ });
        } catch(e) { /* ignore */ }
      });
      window.removeEventListener('touchstart', tryUnlockAudio);
      window.removeEventListener('mousedown', tryUnlockAudio);
    }
    window.addEventListener('touchstart', tryUnlockAudio, {passive:true});
    window.addEventListener('mousedown', tryUnlockAudio);

    canvas.addEventListener("click", e=>{
      if(!attempts || gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // efeito clique
      const effect = document.createElement("div");
      effect.className = "clickEffect";
      effect.innerText = "‚ú®";
      effect.style.left = (e.pageX - 10) + "px";
      effect.style.top = (e.pageY - 20) + "px";
      document.body.appendChild(effect);
      setTimeout(()=>effect.remove(),800);

      const caught = fish.find(f=> Math.hypot(f.x-x,f.y-y)<f.size);
      if(caught){
        // tocar som de captura (com try/catch para evitar erros)
        try { catchSound.currentTime = 0; catchSound.play().catch(()=>{}); } catch(e) {}

        let now = Date.now();
        let prize = prizes[Math.floor(Math.random()*prizes.length)];

        if (now - startTime < minWinTime) {
          prize = "N√£o foi dessa vez";
        }

        if(prize==="N√£o foi dessa vez"){
          speech.innerText="N√£o foi dessa vez...";
          speech.style.display="block";
          setTimeout(()=>speech.style.display="none",1500);
          // efeito gotas
          spawnDrops(16);
        } else {
          try { winSound.currentTime = 0; winSound.play().catch(()=>{}); } catch(e) {}
          prizeBox.innerText="üéâ Parab√©ns! Voc√™ ganhou: "+prize;
          prizeBox.style.animation="pop 0.6s forwards";
          speech.innerText="Uau! Voc√™ conseguiu üéâ";
          speech.style.display="block";
          confetti({
            particleCount: 200,
            spread: 100,
            origin: { y: 0.6 },
            colors: ["#FFD700","#FFFACD","#FF4500"]
          });
          attempts = false;
          gameOver = true;
          // salva a data da vit√≥ria (YYYY-MM-DD)
          localStorage.setItem("lastWinDate", today);
          clearInterval(timerInterval);
        }
      }
    });

    // gotas (quando perde)
    function spawnDrops(n) {
      for (let i = 0; i < n; i++) {
        const d = document.createElement("div");
        d.style.position = "fixed";
        d.style.left = Math.random() * 100 + "vw";
        d.style.top = "-10px";
        d.style.fontSize = 14 + Math.random() * 18 + "px";
        d.style.pointerEvents = "none";
        d.textContent = "üíß";
        document.body.appendChild(d);
        let topVal = -10;
        const fall = setInterval(() => {
          topVal += 8 + Math.random()*6;
          d.style.top = topVal + "px";
          if (topVal > window.innerHeight) {
            clearInterval(fall);
            d.remove();
          }
        }, 40);
      }
    }

    const timerInterval = setInterval(()=>{
      if (timeLeft <= 0 && !gameOver) {
        gameOver = true;
        prizeBox.innerText="N√£o foi dessa vez üí¶";
        prizeBox.style.animation="pop 0.6s forwards";
        speech.innerText="Miauu... n√£o foi dessa vez üòø";
        speech.style.display="block";
        try { failSound.currentTime = 0; failSound.play().catch(()=>{}); } catch(e) {}
        clearInterval(timerInterval);
        spawnDrops(18);
      } else if (!gameOver) {
        timeLeft--;
        timerEl.innerText = "Tempo: " + timeLeft + "s";
      }
    },1000);
  </script>
</body>
</html>
